!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("xgplayer")):"function"==typeof define&&define.amd?define(["xgplayer"],t):"object"==typeof exports?exports["xgplayer-mp4"]=t(require("xgplayer")):e["xgplayer-mp4"]=t(e.xgplayer)}(this,(function(e){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=14)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=o(n(1)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.headSize=8,this.size=0,this.type="",this.subBox=[],this.start=-1}return i(e,[{key:"readHeader",value:function(e){if(this.start=e.position,this.size=e.readUint32(),this.type=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),1===this.size)this.size=e.readUint64();else if(0===this.size&&"mdat"!==this.type)throw new a.default("parse","",{line:19,handle:"[Box] readHeader",msg:"parse mp4 mdat box failed"});if("uuid"===this.type)for(var t=[],n=0;n<16;n++)t.push(e.readUint8());"pssh"===this.type&&(this.version=e.readUint8(),this.flags=e.readUint8())}},{key:"readBody",value:function(t){var n=this.size-t.position+this.start,i=this.type;this.data=t.buffer.slice(t.position,t.position+n),t.position+=this.data.byteLength;var r=void 0;(r=e.containerBox.find((function(e){return e===i}))?e.containerParser:e[i])&&r instanceof Function&&r.call(this)}},{key:"read",value:function(e){this.readHeader(e),this.readBody(e)}}],[{key:"containerParser",value:function(){for(var t=new r.default(this.data),n=t.buffer.byteLength;t.position<n;){var i=new e;i.readHeader(t),this.subBox.push(i),i.readBody(t)}delete this.data,t=null}}]),e}();u.containerBox=["moov","trak","edts","mdia","minf","dinf","stbl","mvex","moof","traf","mfra","sinf","schi"],t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(2),o=(i=a)&&i.__esModule?i:{default:i};var u=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),!(t instanceof ArrayBuffer))throw new o.default("parse","",{line:9,handle:"[Stream] constructor",msg:"data is valid"});this.buffer=t,this.dataview=new DataView(t),this.dataview.position=0}return r(e,[{key:"skip",value:function(t){for(var n=Math.floor(t/4),i=t%4,r=0;r<n;r++)e.readByte(this.dataview,4);i>0&&e.readByte(this.dataview,i)}},{key:"readUint8",value:function(){return e.readByte(this.dataview,1)}},{key:"readUint16",value:function(){return e.readByte(this.dataview,2)}},{key:"readUint24",value:function(){return e.readByte(this.dataview,3)}},{key:"readUint32",value:function(){return e.readByte(this.dataview,4)}},{key:"readUint64",value:function(){return e.readByte(this.dataview,8)}},{key:"readInt8",value:function(){return e.readByte(this.dataview,1,!0)}},{key:"readInt16",value:function(){return e.readByte(this.dataview,2,!0)}},{key:"readInt32",value:function(){return e.readByte(this.dataview,4,!0)}},{key:"position",set:function(e){this.dataview.position=e},get:function(){return this.dataview.position}}],[{key:"readByte",value:function(e,t,n){var i=void 0;switch(t){case 1:i=n?e.getInt8(e.position):e.getUint8(e.position);break;case 2:i=n?e.getInt16(e.position):e.getUint16(e.position);break;case 3:if(n)throw"not supported for readByte 3";i=e.getUint8(e.position)<<16,i|=e.getUint8(e.position+1)<<8,i|=e.getUint8(e.position+2);break;case 4:i=n?e.getInt32(e.position):e.getUint32(e.position);break;case 8:if(n)throw new o.default("parse","",{line:73,handle:"[Stream] readByte",msg:"not supported for readBody 8"});i=e.getUint32(e.position)<<32,i|=e.getUint32(e.position+4);break;default:i=""}return e.position+=t,i}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=n(3),a=(i=r)&&i.__esModule?i:{default:i},o=n(36);function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var f=function(e){function t(e,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";u(this,t),i.version=o.version;var a=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n,i));return a.url=r,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),t}(a.default.Errors);t.default=f,e.exports=t.default},function(t,n){t.exports=e},function(e,t,n){"use strict";var i,r,a,o,u,s,f,d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=n(17),c=n(34),h=Function.prototype.apply,p=Function.prototype.call,v=Object.create,y=Object.defineProperty,m=Object.defineProperties,_=Object.prototype.hasOwnProperty,g={configurable:!0,enumerable:!1,writable:!0};r=function(e,t){var n,r;return c(t),r=this,i.call(this,e,n=function(){a.call(r,e,n),h.call(t,this,arguments)}),n.__eeOnceListener__=t,this},u={on:i=function(e,t){var n;return c(t),_.call(this,"__ee__")?n=this.__ee__:(n=g.value=v(null),y(this,"__ee__",g),g.value=null),n[e]?"object"===d(n[e])?n[e].push(t):n[e]=[n[e],t]:n[e]=t,this},once:r,off:a=function(e,t){var n,i,r,a;if(c(t),!_.call(this,"__ee__"))return this;if(!(n=this.__ee__)[e])return this;if("object"===(void 0===(i=n[e])?"undefined":d(i)))for(a=0;r=i[a];++a)r!==t&&r.__eeOnceListener__!==t||(2===i.length?n[e]=i[a?0:1]:i.splice(a,1));else i!==t&&i.__eeOnceListener__!==t||delete n[e];return this},emit:o=function(e){var t,n,i,r,a;if(_.call(this,"__ee__")&&(r=this.__ee__[e]))if("object"===(void 0===r?"undefined":d(r))){for(n=arguments.length,a=new Array(n-1),t=1;t<n;++t)a[t-1]=arguments[t];for(r=r.slice(),t=0;i=r[t];++t)h.call(i,this,a)}else switch(arguments.length){case 1:p.call(r,this);break;case 2:p.call(r,this,arguments[1]);break;case 3:p.call(r,this,arguments[1],arguments[2]);break;default:for(n=arguments.length,a=new Array(n-1),t=1;t<n;++t)a[t-1]=arguments[t];h.call(r,this,a)}}},s={on:l(i),once:l(r),off:l(a),emit:l(o)},f=m({},s),e.exports=t=function(e){return null==e?v(f):m(Object(e),s)},t.methods=u},function(e,t,n){"use strict";var i=n(28)();e.exports=function(e){return e!==i&&null!==e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=new Date;t.setFullYear(1904),t.setMonth(0),t.setDate(1),t.setHours(0),t.setMinutes(0),t.setSeconds(0),this.time=t}return i(e,[{key:"setTime",value:function(e){return this.time.setTime(this.time.getTime()+1*e),this.time.toLocaleString()}}]),e}();t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(11),o=(i=a)&&i.__esModule?i:{default:i};var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,n=t.byteLength,i=new Uint8Array(n),r=0,a=0;a<n;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(i[r]=t[a],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(t){var n=e._ebsp2rbsp(t),i=new o.default(n);i.readByte();var r=i.readByte();i.readByte();var a=i.readByte();i.readUEG();var u=e.getProfileString(r),s=e.getLevelString(a),f=1,d=420,l=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(3===(f=i.readUEG())&&i.readBits(1),f<=3&&(d=[0,420,422,444][f]),l=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var c=3!==f?8:12,h=0;h<c;h++)i.readBool()&&(h<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var p=i.readUEG();if(0===p)i.readUEG();else if(1===p){i.readBits(1),i.readSEG(),i.readSEG();for(var v=i.readUEG(),y=0;y<v;y++)i.readSEG()}i.readUEG(),i.readBits(1);var m=i.readUEG(),_=i.readUEG(),g=i.readBits(1);0===g&&i.readBits(1),i.readBits(1);var b=0,w=0,k=0,x=0;i.readBool()&&(b=i.readUEG(),w=i.readUEG(),k=i.readUEG(),x=i.readUEG());var U=1,S=1,B=0,E=!0,T=0,O=0;if(i.readBool()){if(i.readBool()){var C=i.readByte();C>0&&C<16?(U=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][C-1],S=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][C-1]):255===C&&(U=i.readByte()<<8|i.readByte(),S=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var M=i.readBits(32),P=i.readBits(32);E=i.readBool(),B=(T=P)/(O=2*M)}}var R=1;1===U&&1===S||(R=U/S);var I=0,A=0;0===f?(I=1,A=2-g):(I=3===f?1:2,A=(1===f?2:1)*(2-g));var D=16*(m+1),L=16*(_+1)*(2-g);D-=(b+w)*I,L-=(k+x)*A;var z=Math.ceil(D*R);return i.destroy(),i=null,{profile_string:u,level_string:s,bit_depth:l,chroma_format:d,chroma_format_string:e.getChromaFormatString(d),frame_rate:{fixed:E,fps:B,fps_den:O,fps_num:T},par_ratio:{width:U,height:S},codec_size:{width:D,height:L},present_size:{width:z,height:L}}}},{key:"_skipScalingList",value:function(e,t){for(var n=8,i=8,r=0;r<t;r++)0!==i&&(i=(n+e.readSEG()+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}},{key:"toVideoMeta",value:function(e){var t={};e&&e.codec_size&&(t.codecWidth=e.codec_size.width,t.codecHeight=e.codec_size.height,t.presentWidth=e.present_size.width,t.presentHeight=e.present_size.height),t.profile=e.profile_string,t.level=e.level_string,t.bitDepth=e.bit_depth,t.chromaFormat=e.chroma_format,t.parRatio={width:e.par_ratio.width,height:e.par_ratio.height},t.frameRate=e.frame_rate;var n=t.frameRate.fps_den,i=t.frameRate.fps_num;t.refSampleDuration=Math.floor(t.timescale*(n/i))}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CUSTOM_EVENTS={MEDIA_EXPIRED:"MEDIA_EXPIRED",INIT_FAIL:"INIT_FAIL",PARSE_ERROR:"PARSE_ERROR",BUFFERED_RESET:"BUFFERED_RESET"},t.TASK_ERROR="TASK_ERROR",t.TASK_ERROR_TYPES={ERROR:"ERROR",CODE_ERROR:"CODE_ERROR",CANCEL:"CANCEL"}},function(e,t,n){"use strict";e.exports=function(e){return null!=e}},function(e,t,n){"use strict";var i,r=n(37),a=(i=r)&&i.__esModule?i:{default:i};e.exports=a.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.TAG="Golomb",this._buffer=t,this._bufferIndex=0,this._totalBytes=t.byteLength,this._totalBits=8*t.byteLength,this._currentWord=0,this._currentWordBitsLeft=0}return i(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._totalBytes-this._bufferIndex,t=Math.min(4,e),n=new Uint8Array(4);n.set(this._buffer.subarray(this._bufferIndex,this._bufferIndex+t)),this._currentWord=new DataView(n.buffer).getUint32(0),this._bufferIndex+=t,this._currentWordBitsLeft=8*t}},{key:"readBits",value:function(e){var t=Math.min(this._currentWordBitsLeft,e),n=this._currentWord>>>32-t;if(e>32)throw new Error("Cannot read more than 32 bits at a time");return this._currentWordBitsLeft-=t,this._currentWordBitsLeft>0?this._currentWord<<=t:this._totalBytes-this._bufferIndex>0&&this._fillCurrentWord(),(t=e-t)>0&&this._currentWordBitsLeft?n<<t|this.readBits(t):n}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._currentWordBitsLeft;e++)if(0!=(this._currentWord&2147483648>>>e))return this._currentWord<<=e,this._currentWordBitsLeft-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(10),o=(i=a)&&i.__esModule?i:{default:i};var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=new Uint8Array(0)}return r(e,[{key:"write",value:function(){for(var e=this,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];n.forEach((function(t){t?e.buffer=(0,o.default)(Uint8Array,e.buffer,t):window.console.error(t)}))}}],[{key:"writeUint16",value:function(e){return new Uint8Array([e>>8&255,255&e])}},{key:"writeUint32",value:function(e){return new Uint8Array([e>>24,e>>16&255,e>>8&255,255&e])}}]),e}();t.default=u,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=s(n(4)),a=s(n(2)),o=n(8),u=s(n(84));function s(e){return e&&e.__esModule?e:{default:e}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var d=function(){function e(t,n,i,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};f(this,e),(0,r.default)(this),window.Task=e,this.url=t,this.range=n,o.start=n[0],o.end=n[1],this.uniqueTag=this.url+"&range="+n[0]+"-"+n[1],this.playerId=o.playerId,e.queue.some((function(e){return e.url===t&&JSON.stringify(e.range)===JSON.stringify(n)&&e.playerId===o.playerId}))||(this.xhrSetup=i,this.id=this.playerId+n.join("-"),this.running=!1,this.canceled=!1,this.initialize(t,n,a))}return i(e,[{key:"initialize",value:function(t,n,i){var r=new window.XMLHttpRequest;r.target=this,r.responseType="arraybuffer",r.withCredentials=this.withCredentials||!1,r.open("get",t),"function"==typeof this.xhrSetup&&this.xhrSetup(r,t),r.setRequestHeader("Range","bytes="+n[0]+"-"+n[1]);var s=this;r.onreadystatechange=function(e){2===r.readyState&&(s.headers=(0,u.default)(r),s.status=r.status),r.readyState},r.onload=function(){200===r.status||206===r.status?i&&i instanceof Function&&i(r.response):403===r.status?s.emit(o.CUSTOM_EVENTS.MEDIA_EXPIRED):s._emitTaskError(o.TASK_ERROR_TYPES.CODE_ERROR),r.target.remove()},r.onerror=function(e){r.target.emit("error",new a.default("network","",{line:25,handle:"[Task] constructor",msg:e.message,url:t})),r.target.remove()},r.onabort=function(){r.target.remove()},s.canceled||(s.xhr=r,e.queue.push(s)),s.update()}},{key:"cancel",value:function(){this.xhr.abort(),this._emitTaskError(o.TASK_ERROR_TYPES.CANCEL),this.canceled=!0}},{key:"_emitTaskError",value:function(e){this.emit(o.TASK_ERROR,{code:e,url:this.uniqueTag,readyState:this.xhr.readyState,status:this.xhr.status})}},{key:"remove",value:function(){var t=this;e.queue.filter((function(n,i){return n.url===t.url&&n.id===t.id&&(e.queue.splice(i,1),!0)})),this.update()}},{key:"update",value:function(){var t=e.queue,n=t.filter((function(e){return e.running})),i=t.filter((function(e){return!e.running})),r=e.limit-n.length;i.forEach((function(e,t){t<r&&e.run()}))}},{key:"run",value:function(){1===this.xhr.readyState||1===this.xhr.OPENED?(this.running=!0,this.xhr.send()):this.remove()}}],[{key:"clear",value:function(t){for(var n=e.queue,i=n.length-1;i>-1;i--){var r=n[i];r.running&&r.playerId===t&&r.cancel(),n.splice(i,1)}}}]),e}();d.queue=[],d.limit=2,t.default=d,e.exports=t.default},function(e,t,n){e.exports=n(15)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=function e(t,n,i){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var a=Object.getPrototypeOf(t);return null===a?void 0:e(a,n,i)}if("value"in r)return r.value;var o=r.get;return void 0!==o?o.call(i):void 0},o=v(n(3)),u=v(n(16)),s=v(n(86)),f=v(n(13)),d=n(87),l=v(n(88)),c=v(n(89)),h=n(8),p=v(n(90));function v(e){return e&&e.__esModule?e:{default:e}}var y=o.default.sniffer,m=function(e,t){t.meta.endTime-e.currentTime<.5&&(e.duration-e.currentTime<.5&&(e.mse.endOfStream(),e._stopProgress()))},_=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=!0;(e.onlyInit||e.videoInit)&&(e.onlyInit=!0,e.autoplay=!1,e.videoInit=!1,n=!1);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return i._pendingPromises=[],i._allInitPromise=new l.default,i._maxBufferLength=e.maxBufferLength||5,i._playerId=t.uniqueId++,i._onBufferedResetFunc=i._onBufferedReset.bind(i),i._onSeekingFunc=i._onSeeking.bind(i),i._onMp4InitFunc=i._onMp4Init.bind(i),i._onWaitingFunc=i._onWaiting.bind(i),i._onEndedFunc=i._onEnded.bind(i),i._onDestroyFunc=i._onDestroy.bind(i),i._replay=i._onReplay.bind(i),i._onOnlineHandlerFunc=i._onOnlineHandler.bind(i),i._onOfflineHandlerFunc=i._onOfflineHandler.bind(i),i._tickInSeconds=e.tickInSeconds||.2,i._hasStartProgress=n,i._hasStartProgressBack=n,i.video.addEventListener(h.CUSTOM_EVENTS.BUFFERED_RESET,i._onBufferedResetFunc),i._bindNetworkStateChange(),i._initMp4Kernal(),i.once("ready",(function(){i.gapJumpInst=new p.default(i,i.config),o.default.util.on(i,"addVideoBufferEnd",(function(){i.gapJumpInst.onSegmentAppend()}))})),i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"_initMp4Kernal",value:function(){var e=this,t=e.config.pluginRule||function(){return!0};if(s.default.isSupported('video/mp4; codecs="avc1.64001E, mp4a.40.5"')){if(!t.call(e))return!1;Object.defineProperty(e,"src",{get:function(){return e.currentSrc},set:function(t){e.mse.endOfStream(),e._onDestroy(),e.config.autoplay=e.autoplay=!0,e.config.url=t,e._init(t).then((function(t){var n=t[0],i=t[1];e.proxyOnce("canplay",(function(){e.play(),e.proxyOn("waiting",e._onWaitingFunc)})),e._startProgress(),e._onSuperStart(i.url),e.mp4=n,e.mse=i}),(function(t){e._errorHandle(t)}))},configurable:!0}),e.proxyOn("ended",e._onEndedFunc),e.proxyOnce("destroy",e._onDestroyFunc),(e.config.videoInit||e.config.onlyInit)&&e.start(e.config.url)}}},{key:"start",value:function(e){var t=this;e=e||t.config.url,t.config.autoplay&&"chrome"==o.default.sniffer.browser&&!o.default.util.hasClass(t.root,"xgplayer-is-enter")&&o.default.util.addClass(t.root,"xgplayer-is-enter"),t.proxyOnce("error",(function(){o.default.util.hasClass(t.root,"xgplayer-is-enter")&&o.default.util.removeClass(t.root,"xgplayer-is-enter")})),t.proxyOn("timeupdate",(function(){o.default.util.hasClass(t.root,"xgplayer-isloading")&&o.default.util.removeClass(t.root,"xgplayer-isloading")})),t.proxyOnce("canplay",(function(){if(o.default.util.hasClass(t.root,"xgplayer-is-enter")&&o.default.util.removeClass(t.root,"xgplayer-is-enter"),"safari"===y.browser&&t.buffered&&t.config.autoplay){var e=t.buffered.start(0);t.currentTime=e+.1}}));var n=t._init(e);n.id="init",t._addPendingPromise(n),n.then((function(e){t._allInitPromise.resolve(),t._hasInited=!0,t._removePendingPromise(n);var i=e[0],r=e[1];t.config.autoplay&&t.proxyOnce("canplay",(function(){t.play()})),t._onSuperStart(r.url),t.mp4=i,t.mse=r,o.default.util.on(i,"error",(function(e){t._errorHandle(e)})),t.proxyOn("seeking",t._onSeekingFunc),t.proxyOnce("playing",t._onMp4InitFunc),t.proxyOn("waiting",t._onWaitingFunc),t._startProgress()}),(function(n){"DESTROYED"!==n&&(t._onSuperStart(e),t._errorHandle(n))}))}},{key:"switchURL",value:function(e){var t=this,n=new u.default(e,t.config.xhrSetup,t,t.config.preloadSize,{playerId:t._playerId}),i=t.mp4;o.default.util.on(n,"moovReady",(function(){i.timeRage;var e=t.currentTime,r=i.timeRage.find((function(t){return t[0]-e>2}))[0],a=t.getBufferedRange(t.buffered2)[1];a-r>0&&"safari"!==y.browser&&t.mse.removeBuffer(r,a),o.default.util.hasClass(t.root,"xgplayer-ended")||t.emit("urlchange"),t.mp4=n,t.mse.appendBuffer(n.packMeta(i.meta))})),o.default.util.on(n,"error",(function(e){t._errorHandle(e)}))}},{key:"_onBufferedReset",value:function(){this.mp4&&this.mp4.timeRage&&this.mp4.timeRage.forEach((function(e){e.downloaded=!1}))}},{key:"_onOnlineHandler",value:function(){this._hasInited?(this._hasStartProgressBack&&this._startProgress(),this._hasStartProgressBack=!1):this.src=this.config.url}},{key:"_onOfflineHandler",value:function(){this._hasStartProgress&&(this._stopProgress(),this._hasStartProgressBack=!0)}},{key:"_bindNetworkStateChange",value:function(){window.addEventListener("online",this._onOnlineHandlerFunc),window.addEventListener("offline",this._onOfflineHandlerFunc)}},{key:"_unbindNetworkStateChange",value:function(){window.removeEventListener("online",this._onOnlineHandlerFunc),window.removeEventListener("offline",this._onOfflineHandlerFunc)}},{key:"_onSuperStart",value:function(e){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"start",this).call(this,e)}},{key:"_init",value:function(e){var t=new l.default;return this._initMp4(e,t),t}},{key:"_initMse",value:function(e,t,n){var i=this,r=t.videoCodec.indexOf("hvc1")>-1||t.encv&&t.encv.data_format.indexOf("hvc1")>-1,a=!!t.videoCodec,u=!!t.audioCodec,f=void 0;f=a&&u?r?'video/mp4; codecs="hev1.1.6.L93.B0, mp4a.40.5"':'video/mp4; codecs="avc1.64001E, mp4a.40.5"':a?r?'video/mp4; codecs="hev1.1.6.L93.B0"':'video/mp4; codecs="avc1.64001E"':'video/mp4; codecs="mp4a.40.5"';var d=new s.default(f,i.config.mediaType);o.default.util.on(d,"sourceopen",(function(){var t=e.packMeta(e.meta);d.appendBuffer(t),o.default.util.once(d,"updateend",(function(){i._loadData()}))})),o.default.util.on(d,"error",(function(e){n.reject(e)})),n.resolve([e,d])}},{key:"_initMp4",value:function(e,t){var n=this,i=new u.default(e,this.config.xhrSetup,this,this.config.preloadSize,{playerId:this._playerId});o.default.util.once(i,"metaReady",(function(e){n._initMse(i,e,t)})),o.default.util.on(i,"error",(function(e){t.reject(e)}))}},{key:"_loadData",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(navigator.onLine){var n=this;n.mp4&&(t=t||n.currentTime,n.mp4.seek(t+.1*e).then((function(e){if(e&&n.mse){var t=n.mse;t.updating=!0,o.default.util.once(t,"updateend",(function(){t.updating=!1,n.emit("addVideoBufferEnd")})),t.appendBuffer(e)}}),(function(){e<10&&setTimeout((function(){n._loadData(e+1)}),2e3)})))}}},{key:"_onTimeUpdate",value:function(){var e=this,t=e.mse,n=e.mp4;if(t&&!t.updating&&n&&n.canDownload){var i=n.timeRage,r=e.getBufferedRange(e.buffered2),a=e.currentTime+e._maxBufferLength;if(r[1]-a>0)return;i.every((function(t,n){return!!t.downloaded||(0===r[1]?!(t[0]<=e.currentTime&&(e.currentTime<t[1]||e.duration-t[1]<.5))||(e._loadData(0,t[0]),!1):!(t[0]>=r[1]||t[1]-1>=r[1]||r[1]>=t[0]&&r[1]<=t[0]+1)||(e._loadData(0,t[0]),!1))})),m(e,n)}}},{key:"_onWaiting",value:function(){var e=this.currentTime;this._onInnerWait(e),e+2<this.duration&&this._onInnerWait(e+2),e-2>0&&this._onInnerWait(e-2)}},{key:"_onEnded",value:function(){this.off("waiting",this._onWaitingFunc),this._stopProgress()}},{key:"_onReplay",value:function(){var e=this;e._onDestroy(),e._init(e.config.url).then((function(t){var n=t[0],i=t[1];e._startProgress(),e._onSuperStart(i.url),e.mp4=n,e.mse=i,e.proxyOnce("canplay",(function(){e.play(),e.proxyOn("waiting",e._onWaitingFunc)}))}),(function(t){e._errorHandle(t)}))}},{key:"_onDestroy",value:function(){this._hasInited=!1,this._unbindNetworkStateChange(),f.default.clear(this._playerId),this.mp4&&(this.mp4.destroy(),this.mp4=null),this.mse&&this.mse.destroy(),this.unloadVideo(),this._stopProgress(),this.cancelPendingPromises()}},{key:"_errorHandle",value:function(e){if("network"!==e.errt&&"network"!==e.errorType&&"parse"!==e.errt&&"parse"!==e.errorType){var t=this;e.url=t.src,e.errd&&"object"===i(e.errd)&&t.mp4&&(e.errd.url=t.mp4.url,e.url=t.mp4.url,t.mp4.canDownload=!1),t.emit("DATA_REPORT",e),f.default.clear(t._playerId),t.mp4&&t.mp4.bufferCache&&t.mp4.bufferCache.clear(),t.currentTime&&(t._currentTime=t.currentTime),t._start&&(t.start=t._start,t._start=null),t.switchURL=null,t._replay=null,t.off("seeking",t._onSeekingFunc),t.off("playing",t._onMp4InitFunc),t.off("waiting",t._onWaitingFunc),t.off("ended",t._onEndedFunc),t.off("destroy",t._onDestroyFunc),iplayer.emit("error",e),t.src=t.config.url,t.proxyOnce("canplay",(function(){t._currentTime&&(t.currentTime=t._currentTime),t.play()}))}}},{key:"_onSeeking",value:function(){var e=this.currentTime;this._onCheckLoad(e),m(this,this.mp4)}},{key:"_onInnerWait",value:function(e){this._onCheckLoad(e)}},{key:"_onCheckLoad",value:function(e){var t=this,n=t.buffered2||t.buffered,i=!1,r=t.mp4.timeRage;if(n.length){for(var a=0,o=n.length;a<o;a++)if(e>=n.start(a)&&e<=n.end(a)){i=!0;break}i||r.every((function(n,i){return!(n[0]<=e&&(n[1]>e||t.duration-n[1]<.5))||(t._loadData(0,n[0]),!1)}))}else r.every((function(n,i){return!(n[0]<=e&&n[1]>e)||(t._loadData(0,n[0]),!1)}))}},{key:"_onMp4Init",value:function(){this.config.mp4Init&&this.pause()}},{key:"_stopProgress",value:function(){this._hasStartProgress=!1,this._requestTimer&&(this._requestTimer.stop(),this._requestTimer=null)}},{key:"_startProgress",value:function(){var e=this;e._stopProgress(),e._requestTimer=new c.default((function(){e._requestTimer&&e._onTimeUpdate()})),e._requestTimer.tickEvery(e._tickInSeconds),this._hasStartProgress=!0}},{key:"unloadVideo",value:function(){try{this.video&&this.video.src&&(this.video.removeAttribute("src"),this.video.load())}catch(e){}}},{key:"_addPendingPromise",value:function(e){this._pendingPromises.push(e)}},{key:"_removePendingPromise",value:function(e){var t=this._pendingPromises.indexOf(e);t>-1&&this._pendingPromises.splice(t,1)}},{key:"onMediaExpired",value:function(){this._stopProgress(),this.emit(h.CUSTOM_EVENTS.MEDIA_EXPIRED)}},{key:"cancelPendingPromises",value:function(){this._pendingPromises.length>0&&this._pendingPromises.forEach((function(e){e.reject("DESTROYED")})),this._pendingPromises=[]}},{key:"enableAutoBuffer",value:function(e){var t=this;if(e){if(!this._allInitPromise)return;this._allInitPromise.then((function(){t._startProgress()}))}else this._stopProgress()}},{key:"destroy",value:function(){this.mp4&&this.mp4.destroy(),this.mse&&this.mse.destroy(),this.video&&this.video.removeEventListener(h.CUSTOM_EVENTS.BUFFERED_RESET,this._onBufferedResetFunc),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"emitInitFail",value:function(e){this.emit(h.CUSTOM_EVENTS.INIT_FAIL,e)}},{key:"emitParseError",value:function(){this.emit(h.CUSTOM_EVENTS.PARSE_ERROR)}},{key:"ready",get:function(){return this._allInitPromise}}]),t}(o.default);_.uniqueId=1,_.isSupported=d.isSupported,_.isSupportedWithXgmse=d.isSupportedWithXgmse,_.isMediaSourceSupported=d.isMediaSourceSupported,_.CUSTOM_EVENTS=h.CUSTOM_EVENTS,t.default=_,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=h(n(4)),a=h(n(35)),o=h(n(12)),u=h(n(83)),s=h(n(13)),f=h(n(85)),d=h(n(2)),l=n(8),c=h(n(3));function h(e){return e&&e.__esModule?e:{default:e}}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var v=function(){function e(t,n,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.pow(25,4),o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};p(this,e),(0,r.default)(this),this.url=t,this.xhrSetup=n,this.CHUNK_SIZE=a,this.player=i,this.ext=o,this.timeRage=[],this.canDownload=!0,this.init(),c.default.util.once(this,"moovReady",this.moovParse.bind(this))}return i(e,[{key:"getData",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t+this.CHUNK_SIZE-1,i=this;return new Promise((function(r,a){var o=new s.default(e.url,[t,n],e.xhrSetup,(function(e){i.hasDestroyed||r(e)}),i.ext);c.default.util.once(o,l.CUSTOM_EVENTS.MEDIA_EXPIRED,(function(){i.player&&i.player.onMediaExpired()})),c.default.util.once(o,l.TASK_ERROR,(function(e){a({code:e.code,status:e.status})}))}))}},{key:"moovParse",value:function(){var e=this,t=this,n=this.moovBox,i=f.default.findBox(n,"mvhd"),r=f.default.findBox(n,"trak"),a=void 0,o=void 0,u=void 0,s=void 0,l=void 0,c=void 0,h=void 0,p=void 0,v=void 0,y=void 0,m=void 0,_=void 0,g=void 0,b=void 0,w=void 0,k=void 0,x=void 0,U=[1,1];if(Array.isArray(r)||(r=[r]),r.forEach((function(e){var n=f.default.findBox(e,"hdlr"),i=f.default.findBox(e,"mdhd");if(n&&i){var r=f.default.findBox(e,"stsd").subBox[0];if("vide"===n.handleType){var S=f.default.findBox(e,"avcC"),B=void 0;S||(B=f.default.findBox(e,"hvcC"));var E=f.default.findBox(e,"tkhd");if(a=e,l=i.timescale,S)u=r.type+"."+f.default.toHex(S.profile,S.profileCompatibility,S.AVCLevelIndication).join(""),h=S.sequence,U=[S.spsInfo.par_ratio.width,S.spsInfo.par_ratio.height],S.spsInfo.codec_size&&(m=S.spsInfo.codec_size.width,_=S.spsInfo.codec_size.height),p=S.pps&&S.pps.map((function(e){return Number("0x"+e)})),y=S.profile;else if(B){x=B.data;var T=f.default.findBox(e,"hvc1");T&&(k=T.data,m=T.width,_=T.height),u=r.type+"."+f.default.toHex(B.profile,B.profileCompatibility,B.profileCompatibilityIndications).join(""),v=B.vps&&B.vps.map((function(e){return Number("0x"+e)})),h=B.sequence,p=B.pps&&B.pps.map((function(e){return Number("0x"+e)})),y=B.profile}else u=""+r.type;E&&!m&&(m=E.width,_=E.height)}if("soun"===n.handleType){o=e;var O=f.default.findBox(e,"esds"),C=f.default.findBox(e,"mp4a"),M=f.default.findBox(e,5);c=i.timescale,s=O?r.type+"."+f.default.toHex(O.subBox[0].subBox[0].typeID)+"."+O.subBox[0].subBox[0].subBox[0].type:""+r.type,M&&M.EScode&&(w=M.EScode.map((function(e){return Number("0x"+e)}))),C&&(g=C.channelCount,b=C.sampleRate)}}else t.emit("error",new d.default("parse","",{line:101,handle:"[MP4] moovParse",url:t.url}))})),h){this.videoTrak=a,this.audioTrak=o||null;var S=this._boxes.find((function(e){return"mdat"===e.type})),B=f.default.seekTrakDuration(a,l),E=o?f.default.seekTrakDuration(o,c):B;this.mdatStart=S.start;var T=this.videoKeyFrames,O=T.length-1;T.forEach((function(t,n){n<O?e.timeRage.push([t.time.time/l,T[n+1].time.time/l]):e.timeRage.push([t.time.time/l,i.duration/i.timeScale])})),this.meta={videoCodec:u,audioCodec:s,createTime:i.createTime,modifyTime:i.modifyTime,duration:i.duration/i.timeScale,timeScale:i.timeScale,videoDuration:B,videoTimeScale:l,audioDuration:E,audioTimeScale:c,endTime:Math.min(B,E),vps:v,sps:h,pps:p,width:m,height:_,profile:y,pixelRatio:U,channelCount:g,sampleRate:b,audioConfig:w,hvc1Data:k,hvcCData:x,ext:{videoTrak:this.videoTrak,audioTrak:this.audioTrak,mdatStart:this.mdatStart,timeRage:this.timeRage},stss:this._stssObj},this.emit("metaReady",this.meta)}}},{key:"init",value:function(){var e=this;e.getData().then((function(t){var n=void 0,i=0,r=void 0,o=void 0;try{n=new a.default(t)}catch(t){return e.emit("error",t.type?t:new d.default("parse","",{line:176,handle:"[MP4] init",msg:t.message})),!1}if(e._boxes=o=n.boxes,o.every((function(t){return i+=t.size,"moov"!==t.type||(r=t,e.moovBox=r,e.emit("moovReady",r),!1)})),!r){var u=n.nextBox;u?"moov"===u.type?e.getData(i,i+u.size+28).then((function(t){var n=void 0;n=new a.default(t),e._boxes=e._boxes.concat(n.boxes),(r=n.boxes.filter((function(e){return"moov"===e.type}))).length?(e.moovBox=r[0],e.emit("moovReady",r)):e.emit("error",new d.default("parse","",{line:203,handle:"[MP4] init",msg:"not find moov box"}))})):e.emit("error",new d.default("parse","",{line:207,handle:"[MP4] init",msg:"not find moov box"})):e.getData(i,"").then((function(t){var n=new a.default(t);n?(e._boxes=e._boxes.concat(n.boxes),n.boxes.every((function(t){return"moov"!==t.type||(r=t,e.moovBox=r,e.emit("moovReady",r),!1)}))):e.emit("error",new d.default("parse","",{line:225,handle:"[MP4] init",msg:"not find moov box"}))}))}})).catch((function(){e.emit("error",new d.default("network","",{line:231,handle:"[MP4] getData",msg:"getData failed"}))}))}},{key:"getSamplesByOrders",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"video",t=arguments[1],n=arguments[2],i="video"===e?this.videoTrak:this.audioTrak,r=f.default.findBox(i,"stsc"),a=f.default.findBox(i,"stsz"),o=f.default.findBox(i,"stts"),u=f.default.findBox(i,"stco"),s="video"===e?this._cttsObj:null,d="video"===e?this._stscVideoObj:this._stscAudioObj,l=this.mdatStart,c=[];if(n=void 0!==n?n:a.entries.length,t instanceof Array)t.forEach((function(e,t){c.push({idx:e,size:a.entries[e],time:f.default.seekSampleTime(o,s,e),offset:f.default.seekSampleOffset(r,u,a,e,l,d)})}));else if(0!==n)for(var h=t;h<n;h++)c.push({idx:h,size:a.entries[h],time:f.default.seekSampleTime(o,s,h),offset:f.default.seekSampleOffset(r,u,a,h,l,d)});else{var p=f.default.seekSampleOffset(r,u,a,t,l,d);c={idx:t,size:a.entries[t],time:f.default.seekSampleTime(o,s,t),offset:p}}return c}},{key:"packMeta",value:function(){if(this.meta){var e=new o.default;return e.write(u.default.ftyp()),e.write(u.default.moov(this.meta)),e.buffer}}},{key:"getRangeFromTime",value:function(e){var t=this.getFragmentIdx(e),n=this.getFragRange(t);return n===[0,0]?null:{range:n,fragIndex:t}}},{key:"getFragmentIdx",value:function(e){var t=Math.round(e*this.meta.videoTimeScale),n=void 0,i=this.videoKeyFrames;if(i.every((function(e,r){var a=e.time.time,o=i[r+1]?i[r+1].time.time:Number.MAX_SAFE_INTEGER;return!(a<=t&&t<o)||(n=r,!1)})),this.audioTrak){var r=this.audioKeyFrames;r.every((function(e,i){var a=e.startTime,o=r[i+1]?r[i+1].startTime:Number.MAX_SAFE_INTEGER;return!(a<=t&&t<o)||(n=Math.min(i,n),!1)}))}return n}},{key:"seek",value:function(e){var t=this.getFragmentIdx(e);return this.timeRage[t].downloaded=!0,this.loadFragment(t)}},{key:"getFragRange",value:function(e){var t=this.videoKeyFrames[e].offset,n=void 0;if(this.audioTrak){var i=this.getSamplesByOrders("audio",this.audioKeyFrames[e].order,0);t=Math.min(t,i.offset)}if(e<this.videoKeyFrames.length-1&&(n=this.videoKeyFrames[e+1].offset,this.audioTrak)){var r=this.getSamplesByOrders("audio",this.audioKeyFrames[e+1].order,0);n=Math.max(n,r.offset||0)}return window.isNaN(t)||void 0!==n&&window.isNaN(n)?(this.emit("error",new d.default("parse","",{line:366,handle:"[MP4] loadFragment",url:this.url})),[0,0]):[t+this.mdatStart,n?this.mdatStart+n:""]}},{key:"loadFragment",value:function(e){var t=this,n=this,i=this.getFragRange(e);return i!==[0,0]&&this.getData(i[0],i[1]).then((function(r){return n.createFragment(new Uint8Array(r),i[0]-t.mdatStart,e)})).then((function(e){return e}))}},{key:"addFragment",value:function(e){var t=new o.default;return new Promise((function(n){t.write(u.default.moof(e)),t.write(u.default.mdat(e)),n(t.buffer)}))}},{key:"getVideoBuffer",value:function(e,t,n){var i=this.videoKeyFrames.map((function(e){return e.idx})),r=this.getSamplesByOrders("video",i[n],i[n+1]),a=r.map((function(n,i){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===i,idx:n.idx}}));return this.addFragment({id:1,time:r[0].time.time,firstFlags:33554432,flags:3841,samples:a,sampleOffset:r[0].idx,fragIndex:n})}},{key:"getAudioBuffer",value:function(e,t,n){var i=this.getSamplesByOrders("audio",this.audioKeyFrames[n].order,this.audioKeyFrames[n+1]?this.audioKeyFrames[n+1].order:void 0),r=i.map((function(n,i){return{size:n.size,duration:n.time.duration,offset:n.time.offset,buffer:new Uint8Array(e.slice(n.offset-t,n.offset-t+n.size)),key:0===i}}));return this.addFragment({id:2,time:i[0].time.time,firstFlags:0,flags:1793,samples:r,sampleOffset:i[0].idx,fragIndex:n})}},{key:"createFragment",value:function(e,t,n){var i=[],r=[this.getVideoBuffer(e,t,n)];return this.audioTrak&&r.push(this.getAudioBuffer(e,t,n)),Promise.all(r).then((function(e){i.push(e[0]),e&&e[1]&&i.push(e[1]);var t=0;i.every((function(e){return t+=e.byteLength,!0}));var n=new Uint8Array(t),r=0;return i.every((function(e){return n.set(e,r),r+=e.byteLength,!0})),n}))}},{key:"update",value:function(e){this.url=e}},{key:"destroy",value:function(){if(!this.hasDestroyed){for(var e in this)delete this[e];this.hasDestroyed=!0}}},{key:"videoKeyFrames",get:function(){if(this._videoFrames)return this._videoFrames;var e=this.videoTrak,t=f.default.findBox(e,"stss"),n=f.default.findBox(e,"stsc"),i=f.default.findBox(e,"ctts");if(this._cttsObj=null,i){this._cttsObj={};for(var r=0,a=0;a<i.entry.length;a++)for(var o=i.entry[a],u=0;u<o.count;u++)this._cttsObj[r]=o.offset,r+=1}this._stscVideoObj={};for(var s=0,d=0;d<n.count-1;d++)for(var l=n.entries[d],c=0;c<l.chunk_count*l.samples_per_chunk;c++)s++,this._stscVideoObj[s]=l;var h=this.getSamplesByOrders("video",t.entries.map((function(e){return e-1})));return this._stssObj=t,this._videoFrames=h,h}},{key:"audioKeyFrames",get:function(){if(this._audioFrames)return this._audioFrames;var e=f.default.findBox(this.videoTrak,"mdhd").timescale,t=f.default.findBox(this.audioTrak,"mdhd").timescale,n=f.default.findBox(this.audioTrak,"stts").entry,i=f.default.findBox(this.audioTrak,"stsc");this._stscAudioObj={};for(var r=0,a=0;a<i.count-1;a++)for(var o=i.entries[a],u=0;u<o.chunk_count*o.samples_per_chunk;u++)r++,this._stscAudioObj[r]=o;var s;return s=this.videoKeyFrames.map((function(i){return f.default.seekOrderSampleByTime(n,t,i.time.time/e)})),this._audioFrames=s,this._audioFrames}}]),e}();t.default=v,e.exports=t.default},function(e,t,n){"use strict";var i=n(9),r=n(18),a=n(22),o=n(30),u=n(31);(e.exports=function(e,t){var n,r,s,f,d;return arguments.length<2||"string"!=typeof e?(f=t,t=e,e=null):f=arguments[2],i(e)?(n=u.call(e,"c"),r=u.call(e,"e"),s=u.call(e,"w")):(n=s=!0,r=!1),d={value:t,configurable:n,enumerable:r,writable:s},f?a(o(f),d):d}).gs=function(e,t,n){var s,f,d,l;return"string"!=typeof e?(d=n,n=t,t=e,e=null):d=arguments[3],i(t)?r(t)?i(n)?r(n)||(d=n,n=void 0):n=void 0:(d=t,t=n=void 0):t=void 0,i(e)?(s=u.call(e,"c"),f=u.call(e,"e")):(s=!0,f=!1),l={get:t,set:n,configurable:s,enumerable:f},d?a(o(d),l):l}},function(e,t,n){"use strict";var i=n(19),r=/^\s*class[\s{/}]/,a=Function.prototype.toString;e.exports=function(e){return!!i(e)&&!r.test(a.call(e))}},function(e,t,n){"use strict";var i=n(20);e.exports=function(e){if("function"!=typeof e)return!1;if(!hasOwnProperty.call(e,"length"))return!1;try{if("number"!=typeof e.length)return!1;if("function"!=typeof e.call)return!1;if("function"!=typeof e.apply)return!1}catch(e){return!1}return!i(e)}},function(e,t,n){"use strict";var i=n(21);e.exports=function(e){if(!i(e))return!1;try{return!!e.constructor&&e.constructor.prototype===e}catch(e){return!1}}},function(e,t,n){"use strict";var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=n(9),a={object:!0,function:!0,undefined:!0};e.exports=function(e){return!!r(e)&&hasOwnProperty.call(a,void 0===e?"undefined":i(e))}},function(e,t,n){"use strict";e.exports=n(23)()?Object.assign:n(24)},function(e,t,n){"use strict";e.exports=function(){var e,t=Object.assign;return"function"==typeof t&&(t(e={foo:"raz"},{bar:"dwa"},{trzy:"trzy"}),e.foo+e.bar+e.trzy==="razdwatrzy")}},function(e,t,n){"use strict";var i=n(25),r=n(29),a=Math.max;e.exports=function(e,t){var n,o,u,s=a(arguments.length,2);for(e=Object(r(e)),u=function(i){try{e[i]=t[i]}catch(e){n||(n=e)}},o=1;o<s;++o)i(t=arguments[o]).forEach(u);if(void 0!==n)throw n;return e}},function(e,t,n){"use strict";e.exports=n(26)()?Object.keys:n(27)},function(e,t,n){"use strict";e.exports=function(){try{return Object.keys("primitive"),!0}catch(e){return!1}}},function(e,t,n){"use strict";var i=n(5),r=Object.keys;e.exports=function(e){return r(i(e)?Object(e):e)}},function(e,t,n){"use strict";e.exports=function(){}},function(e,t,n){"use strict";var i=n(5);e.exports=function(e){if(!i(e))throw new TypeError("Cannot use null or undefined");return e}},function(e,t,n){"use strict";var i=n(5),r=Array.prototype.forEach,a=Object.create,o=function(e,t){var n;for(n in e)t[n]=e[n]};e.exports=function(e){var t=a(null);return r.call(arguments,(function(e){i(e)&&o(Object(e),t)})),t}},function(e,t,n){"use strict";e.exports=n(32)()?String.prototype.contains:n(33)},function(e,t,n){"use strict";var i="razdwatrzy";e.exports=function(){return"function"==typeof i.contains&&(!0===i.contains("dwa")&&!1===i.contains("foo"))}},function(e,t,n){"use strict";var i=String.prototype.indexOf;e.exports=function(e){return i.call(this,e,arguments[1])>-1}},function(e,t,n){"use strict";e.exports=function(e){if("function"!=typeof e)throw new TypeError(e+" is not a function");return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=$(n(0)),r=$(n(10)),a=$(n(1)),o=$(n(38)),u=$(n(39)),s=$(n(40)),f=$(n(41)),d=$(n(42)),l=$(n(43)),c=$(n(44)),h=$(n(45)),p=$(n(46)),v=$(n(47)),y=$(n(48)),m=$(n(49)),_=$(n(50)),g=$(n(51)),b=$(n(52)),w=$(n(7)),k=$(n(53)),x=$(n(54)),U=$(n(55)),S=$(n(56)),B=$(n(57)),E=$(n(58)),T=$(n(59)),O=$(n(60)),C=$(n(61)),M=$(n(62)),P=$(n(63)),R=$(n(64)),I=$(n(65)),A=$(n(66)),D=$(n(67)),L=$(n(68)),z=$(n(69)),F=$(n(70)),j=$(n(71)),N=$(n(72)),H=$(n(11)),W=$(n(73)),G=$(n(74)),q=$(n(75)),K=$(n(76)),V=$(n(77)),X=$(n(78)),J=$(n(79)),Y=$(n(80)),Z=$(n(81));function $(e){return e&&e.__esModule?e:{default:e}}var Q={};function ee(e,t,n){var i=e;t.map((function(e,r){i[e]=r==t.length-1?n:i[e]||{},i=i[e]}))}ee(Q,["box","avc1"],$(n(82)).default),ee(Q,["box","avcC"],Z.default),ee(Q,["box","btrt"],Y.default),ee(Q,["box","co64"],J.default),ee(Q,["box","ctts"],X.default),ee(Q,["box","dref"],V.default),ee(Q,["box","elst"],K.default),ee(Q,["box","esds"],q.default),ee(Q,["box","frma"],G.default),ee(Q,["box","ftyp"],W.default),ee(Q,["box","golomb"],H.default),ee(Q,["box","hdlr"],N.default),ee(Q,["box","hmhd"],j.default),ee(Q,["box","hvc1"],F.default),ee(Q,["box","hvcC"],z.default),ee(Q,["box","iods"],L.default),ee(Q,["box","mdat"],D.default),ee(Q,["box","mdhd"],A.default),ee(Q,["box","mfhd"],I.default),ee(Q,["box","mp4a"],R.default),ee(Q,["box","MP4DecConfigDescrTag"],P.default),ee(Q,["box","MP4DecSpecificDescrTag"],M.default),ee(Q,["box","MP4ESDescrTag"],C.default),ee(Q,["box","mvhd"],O.default),ee(Q,["box","nmhd"],T.default),ee(Q,["box","pasp"],E.default),ee(Q,["box","sbgp"],B.default),ee(Q,["box","schm"],S.default),ee(Q,["box","sdtp"],U.default),ee(Q,["box","SLConfigDescriptor"],x.default),ee(Q,["box","smhd"],k.default),ee(Q,["box","sps"],w.default),ee(Q,["box","stco"],b.default),ee(Q,["box","stsc"],g.default),ee(Q,["box","stsd"],_.default),ee(Q,["box","stsh"],m.default),ee(Q,["box","stss"],y.default),ee(Q,["box","stsz"],v.default),ee(Q,["box","stts"],p.default),ee(Q,["box","stz2"],h.default),ee(Q,["box","tfhd"],c.default),ee(Q,["box","tkhd"],l.default),ee(Q,["box","traf"],d.default),ee(Q,["box","trun"],f.default),ee(Q,["box","udta"],s.default),ee(Q,["box","url"],u.default),ee(Q,["box","vmhd"],o.default);t.default=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.buffer=null,this.boxes=[],this.nextBox=null,this.start=0;this.buffer?(0,r.default)(Uint8Array,this.buffer,t):this.buffer=t;var n=t.byteLength;t.position=0;for(var o=new a.default(t);n-o.position>=8;){var u=new i.default;if(u.readHeader(o),u.size-8<=n-o.position)u.readBody(o),this.boxes.push(u);else{if("mdat"!==u.type){this.nextBox=u,o.position-=8;break}u.readBody(o),this.boxes.push(u)}}this.buffer=new Uint8Array(this.buffer.slice(o.position))},e.exports=t.default},function(e){e.exports=JSON.parse('{"version":"2.0.3"}')},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){for(var t=0,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];var a=!0,o=!1,u=void 0;try{for(var s,f=i[Symbol.iterator]();!(a=(s=f.next()).done);a=!0){var d=s.value;t+=d.length}}catch(e){o=!0,u=e}finally{try{!a&&f.return&&f.return()}finally{if(o)throw u}}var l=new e(t),c=0,h=!0,p=!1,v=void 0;try{for(var y,m=i[Symbol.iterator]();!(h=(y=m.next()).done);h=!0){var _=y.value;l.set(_,c),c+=_.length}}catch(e){p=!0,v=e}finally{try{!h&&m.return&&m.return()}finally{if(p)throw v}}return l}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.vmhd=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()],this.graphicsmode=e.readUint16(),this.opcolor=[e.readUint16(),e.readUint16(),e.readUint16()],delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default["url "]=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=[e.readUint8(),e.readUint8(),e.readUint8()];for(var t=[],n=e.buffer.byteLength;e.position<n;)t.push(e.readUint8());this.location=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i,r=n(0);((i=r)&&i.__esModule?i:{default:i}).default.udta=function(){delete this.subBox}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";var i=o(n(0)),r=o(n(1)),a=o(n(6));function o(e){return e&&e.__esModule?e:{default:e}}i.default.tkhd=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3,0),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.trackID=e.readUint32(),this.reserverd=e.readUint32(),this.duration=e.readUint32()),e.readUint64(),this.layer=e.readInt16(),this.alternate_group=e.readInt16(),this.volume=e.readInt16()>>8,e.readUint16();for(var t=[],n=0;n<9;n++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,this.width=e.readUint16()+"."+e.readUint16(),this.height=e.readUint16()+"."+e.readUint16(),delete this.data,delete this.subBox,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.tfhd=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.track_id=e.readUint32();var t=1&this.flag,n=2&this.flag,i=8&this.flag,a=16&this.flag,o=32&this.flag;t&&(4,this.baseDataOffset=e.readUint32()),n&&(this.sampleDescriptionIndex=e.readUint32()),i&&(this.defaultSampleDuration=e.readUint32()),a&&(this.defaultSampleSize=e.readUint32()),o&&(this.defaultSampleFlags=e.readUint32()),delete this.subBox,delete this.data,e=null}},function(e,t,n){},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.stts=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.count=e.readUint32();for(var t=[],n=0,i=this.count;n<i;n++)t.push({sampleCount:e.readUint32(),sampleDuration:e.readUint32()});this.entry=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.stsz=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.sampleSize=e.readUint32(),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,i=this.count;n<i;n++)this.sampleSize?t.push(this.sampleSize):t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.stss=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,i=this.count;n<i;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.stsd=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=new i.default;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.stsc=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,i=this.count;n<i;n++)t.push({first_chunk:e.readUint32(),samples_per_chunk:e.readUint32(),sample_desc_index:e.readUint32()});for(var a,o,u=0,s=this.count;u<s-1;u++)a=t[u],o=t[u-1],a.chunk_count=t[u+1].first_chunk-a.first_chunk,a.first_sample=0===u?1:o.first_sample+o.chunk_count*o.samples_per_chunk;if(1===this.count){var f=t[0];f.first_sample=1,f.chunk_count=0}else if(this.count>1){var d=t[this.count-1],l=t[this.count-2];d.first_sample=l.first_sample+l.chunk_count*l.samples_per_chunk,d.chunk_count=0}delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.stco=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,i=this.count;n<i;n++)t.push(e.readUint32());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.smhd=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.balance=e.readInt8()+"."+e.readInt8(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i,r=n(0),a=(i=r)&&i.__esModule?i:{default:i};a.default.SLConfigDescriptor=function(e){var t=new a.default,n=void 0;return t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.SL=e.readUint8(),delete t.subBox,t}},function(e,t,n){},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.schm=function(){var e=new r.default(this.data);this.scheme_version=e.readUint32(),this.scheme_type="";for(var t=0;t<4;t++)this.scheme_type+=String.fromCharCode(e.readUint8());if(1&this.flags){this.scheme_uri="";for(t=0;t<this.size-this.hdr_size-8;t++)this.scheme_uri+=String.fromCharCode(e.readUint8())}}},function(e,t,n){},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.pasp=function(){var e=new r.default(this.data);this.hSpacing=e.readUint32(),this.vSpacing=e.readUint32(),e=null}},function(e,t,n){},function(e,t,n){"use strict";var i=o(n(0)),r=o(n(1)),a=o(n(6));function o(e){return e&&e.__esModule?e:{default:e}}i.default.mvhd=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.timeScale=e.readUint32(),this.duration=e.readUint32(),this.rate=e.readUint16()+"."+e.readUint16(),this.volume=e.readUint8()+"."+e.readUint8(),r.default.readByte(e.dataview,8),r.default.readByte(e.dataview,2);for(var t=[],n=0;n<9;n++)t.push(e.readUint16()+"."+e.readUint16());this.matrix=t,r.default.readByte(e.dataview,24),this.nextTrackID=e.readUint32(),delete this.subBox,delete this.data}},function(e,t,n){"use strict";var i,r=n(0),a=(i=r)&&i.__esModule?i:{default:i};a.default.MP4ESDescrTag=function(e){var t=new a.default,n=void 0;return t.type=e.readUint8(),128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.esID=e.readUint16(),t.priority=e.readUint8(),t.subBox.push(a.default.MP4DecConfigDescrTag(e)),t.subBox.push(a.default.SLConfigDescriptor(e)),t}},function(e,t,n){"use strict";var i,r=n(0),a=(i=r)&&i.__esModule?i:{default:i};a.default.MP4DecSpecificDescrTag=function(e){var t=new a.default,n=void 0,i=void 0;if(t.type=e.readUint8(),5!==t.type)return e.position=e.position-1,t;128===(n=e.readUint8())?(t.extend=!0,e.skip(2),i=(n=e.readUint8()+5)-5):(i=n,n+=2),t.size=n;for(var r=[],o=0;o<i;o++)r.push(Number(e.readUint8()).toString(16).padStart(2,"0"));return t.EScode=r,delete t.subBox,t}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.MP4DecConfigDescrTag=function(e){var t=new i.default,n=void 0;return t.type=e.readUint8(),4!==t.type||(128===(n=e.readUint8())?(t.extend=!0,e.skip(2),n=e.readUint8()+5):n+=2,t.size=n,t.typeID=e.readUint8(),t.streamUint=e.readUint8(),t.bufferSize=r.default.readByte(e.dataview,3),t.maximum=e.readUint32(),t.average=e.readUint32(),t.subBox.push(i.default.MP4DecSpecificDescrTag(e))),t}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.mp4a=function(){var e=new r.default(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(8),this.channelCount=e.readUint16(),this.sampleSize=e.readUint16(),e.skip(4),this.sampleRate=e.readUint32()>>16;var t=new i.default;t.readHeader(e),this.subBox.push(t),t.readBody(e),delete this.data,e=null}},function(e,t,n){},function(e,t,n){"use strict";var i=o(n(0)),r=o(n(1)),a=o(n(6));function o(e){return e&&e.__esModule?e:{default:e}}i.default.mdhd=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),1===this.version?(this.create=e.readUint64(),this.modify=e.readUint64(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint64()):(this.create=e.readUint32(),this.modify=e.readUint32(),this.createTime=(new a.default).setTime(1e3*this.create),this.modifyTime=(new a.default).setTime(1e3*this.modify),this.timescale=e.readUint32(),this.duration=e.readUint32()),this.language=e.readUint16(),e.readUint16(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i,r=n(0);((i=r)&&i.__esModule?i:{default:i}).default.mdat=function(){delete this.subBox}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.iods=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3);for(var t=[],n=e.buffer.byteLength;e.position<n;)t.push(e.readUint8());this.content=t,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));a(n(7));function a(e){return e&&e.__esModule?e:{default:e}}i.default.hvcC=function(){var e=new r.default(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint32(),this.constraintIndicatorFlags=[];for(var t=0;t<6;t++)this.constraintIndicatorFlags.push(Number(e.readUint8()).toString(16));this.levelIdc=e.readUint8(),this.profileCompatibilityIndications=e.readUint32(),this.bitDepthLumaMinus8=e.readUint8(),this.bitDepthChromaMinus8=e.readUint8(),this.avgFrameRate=e.readUint16(),this.constantFrameRate=e.readUint8(),this.numOfArrays=e.readUint8(),this.vpsHeader=e.readUint24(),this.vpsLength=e.readUint16();for(var n=[],i=0;i<this.vpsLength;i++)n.push(Number(e.readUint8()).toString(16));this.vps=n,this.spsHeader=e.readUint24(),this.spsLength=e.readUint16();for(var a=[],o=0;o<this.spsLength;o++)a.push(Number(e.readUint8()).toString(16));this.sequence=a,this.ppsHeader=e.readUint24(),this.ppsLength=e.readUint16();for(var u=[],s=0;s<this.ppsLength;s++)u.push(Number(e.readUint8()).toString(16));this.pps=u;for(var f=[],d=e.dataview.byteLength;e.position<d;)f.push(e.readUint8());this.last=f,delete this.subBox,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.hvc1=function(){var e=new r.default(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var t=0;t<31;t++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var n=new i.default;n.readHeader(e),this.subBox.push(n),n.readBody(e)}e=null}},function(e,t,n){},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.hdlr=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),e.skip(4),this.handleType=""+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8())+String.fromCharCode(e.readUint8()),e.skip(12);for(var t=[];e.position<this.size-8;)t.push(String.fromCharCode(e.readUint8()));this.name=t.join(""),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.ftyp=function(){var e=new r.default(this.data);this.major_brand=String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()),this.minor_version=e.readUint32();for(var t=[],n=0,i=Math.floor((e.buffer.byteLength-8)/4);n<i;n++)t.push(String.fromCharCode(e.readUint8(),e.readUint8(),e.readUint8(),e.readUint8()));this.compatible_brands=t,e=null,delete this.subBox,delete this.data}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.frma=function(){var e=new r.default(this.data);this.data_format="";for(var t=0;t<4;t++)this.data_format+=String.fromCharCode(e.readUint8())}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.esds=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3);try{var t=i.default.MP4ESDescrTag(e);this.subBox.push(t),delete this.data,e=null}catch(e){console.error(e)}}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.elst=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3);var t=[],n=e.readUint32();this.entries=t;for(var i=0;i<n;i++){var a={};t.push(a),1===this.version?(a.segment_duration=e.readUint64(),a.media_time=e.readUint64()):(a.segment_duration=e.readUint32(),a.media_time=e.readInt32()),a.media_rate_integer=e.readInt16(),a.media_rate_fraction=e.readInt16()}delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.dref=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3);var t=e.readUint32();this.entryCount=t;for(var n=0;n<t;n++){var a=new i.default;this.subBox.push(a),a.read(e)}delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.ctts=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.entryCount=e.readUint32();var t=[];this.entry=t;for(var n=0,i=this.entryCount;n<i;n++)t.push({count:e.readUint32(),offset:e.readUint32()});delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.co64=function(){var e=new r.default(this.data);this.version=e.readUint8(),this.flag=r.default.readByte(e.dataview,3),this.count=e.readUint32();var t=[];this.entries=t;for(var n=0,i=this.count;n<i;n++)t.push(e.readUint64());delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.btrt=function(){var e=new r.default(this.data);this.bufferSizeDB=e.readUint32(),this.maxBitrate=e.readUint32(),this.avgBitrate=e.readUint32(),delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=o(n(0)),r=o(n(1)),a=o(n(7));function o(e){return e&&e.__esModule?e:{default:e}}i.default.avcC=function(){var e=new r.default(this.data);this.configVersion=e.readUint8(),this.profile=e.readUint8(),this.profileCompatibility=e.readUint8(),this.AVCLevelIndication=e.readUint8(),this.lengthSizeMinusOne=1+(3&e.readUint8()),this.numOfSequenceParameterSets=31&e.readUint8();var t=e.readUint16();this.sequenceLength=t;for(var n=[],i=0;i<t;i++)n.push(e.readUint8());this.spsInfo=a.default.parseSPS(new Uint8Array(n)),this.ppsCount=e.readUint8();var o=e.readUint16();this.ppsLength=o;for(var u=[],s=0;s<o;s++)u.push(Number(e.readUint8()).toString(16));this.pps=u,this.sequence=n;for(var f=[],d=e.dataview.byteLength;e.position<d;)f.push(e.readUint8());this.last=f,delete this.subBox,delete this.data,e=null}},function(e,t,n){"use strict";var i=a(n(0)),r=a(n(1));function a(e){return e&&e.__esModule?e:{default:e}}i.default.avc1=function(){var e=new r.default(this.data);e.skip(6),this.dataReferenceIndex=e.readUint16(),e.skip(16),this.width=e.readUint16(),this.height=e.readUint16(),this.horizresolution=e.readUint32(),this.vertresolution=e.readUint32(),e.skip(4),this.frameCount=e.readUint16(),e.skip(1);for(var t=0;t<31;t++)String.fromCharCode(e.readUint8());for(this.depth=e.readUint16(),e.skip(2);e.position<e.buffer.byteLength;){var n=new i.default;n.readHeader(e),this.subBox.push(n),n.readBody(e)}delete this.data,e=null}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(12),o=(i=a)&&i.__esModule?i:{default:i};var u=Math.pow(2,32)-1,s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,null,[{key:"type",value:function(e){return new Uint8Array([e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)])}},{key:"size",value:function(e){return o.default.writeUint32(e)}},{key:"extension",value:function(e,t){return new Uint8Array([e,t>>16&255,t>>8&255,255&t])}},{key:"ftyp",value:function(){var t=new o.default;return t.write(e.size(24),e.type("ftyp"),new Uint8Array([105,115,111,54,0,0,0,1,105,115,111,54,100,97,115,104])),t.buffer}},{key:"moov",value:function(t){var n=new o.default,i=8,r=e.mvhd(t.duration,t.timeScale),a=e.mvex(t.duration,t.timeScale),u=e.videoTrak(t),s=new Uint8Array([]);return t.channelCount&&(s=e.audioTrak(t)),[r,a,u,s].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("moov"),r,a,u,s),n.buffer}},{key:"mvhd",value:function(t,n){var i=new o.default;t*=n;var r=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,t>>24&255,t>>16&255,t>>8&255,255&t,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,3]);return i.write(e.size(8+r.length),e.type("mvhd"),new Uint8Array(r)),i.buffer}},{key:"videoTrak",value:function(t){var n=new o.default,i=8,r=e.tkhd({id:1,duration:t.videoDuration,timescale:t.videoTimeScale,width:t.width,height:t.height,type:"video"}),a=e.mdia({type:"video",timescale:t.videoTimeScale,duration:t.videoDuration,vps:t.vps,sps:t.sps,pps:t.pps,pixelRatio:t.pixelRatio,width:t.width,height:t.height,videoCodec:t.videoCodec,hvc1Data:t.hvc1Data,hvcCData:t.hvcCData,stss:t.stss});return[r,a].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("trak"),r,a),n.buffer}},{key:"audioTrak",value:function(t){var n=new o.default,i=8,r=e.tkhd({id:2,duration:t.audioDuration,timescale:t.audioTimeScale,width:0,height:0,type:"audio"}),a=t.channelCount,u=t.sampleRate,s=e.mdia({type:"audio",timescale:t.audioTimeScale,duration:t.audioDuration,channelCount:a,sampleRate:u,audioConfig:t.audioConfig});return[r,s].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("trak"),r,s),n.buffer}},{key:"tkhd",value:function(t){var n=new o.default,i=t.id,r=t.duration*t.timeScale,a=t.width,u=t.height,s=t.type,f=new Uint8Array([0,0,0,3,0,0,0,0,217,172,236,86,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,"video"===s?1:0,"audio"===s?1:0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,u>>8&255,255&u,0,0]);return n.write(e.size(8+f.byteLength),e.type("tkhd"),f),n.buffer}},{key:"edts",value:function(t){var n=new o.default,i=t.duration,r=t.mediaTime;return n.write(e.size(36),e.type("edts")),n.write(e.size(28),e.type("elst")),n.write(new Uint8Array([0,0,0,1,i>>24&255,i>>16&255,i>>8&255,255&i,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,1])),n.buffer}},{key:"mdia",value:function(t){var n=new o.default,i=8,r=e.mdhd(t.timescale),a=e.hdlr(t.type),u=e.minf(t);return[r,a,u].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("mdia"),r,a,u),n.buffer}},{key:"mdhd",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=new o.default;n*=t;Math.floor(n/(u+1)),Math.floor(n%(u+1));var r=new Uint8Array([0,0,0,0,217,20,37,90,t>>24&255,t>>16&255,t>>8&255,255&t,0,0,0,0,21,199,0,0]);return i.write(e.size(12+r.byteLength),e.type("mdhd"),e.extension(0,0),r),i.buffer}},{key:"hdlr",value:function(t){var n=new o.default,i=[0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0];return"audio"===t&&(i.splice.apply(i,[8,4].concat([115,111,117,110])),i.splice.apply(i,[24,13].concat([83,111,117,110,100,72,97,110,100,108,101,114,0]))),n.write(e.size(8+i.length),e.type("hdlr"),new Uint8Array(i)),n.buffer}},{key:"minf",value:function(t){var n=new o.default,i=8,r="video"===t.type?e.vmhd():e.smhd(),a=e.dinf(),u=e.stbl(t);return[r,a,u].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("minf"),r,a,u),n.buffer}},{key:"vmhd",value:function(){var t=new o.default;return t.write(e.size(20),e.type("vmhd"),new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])),t.buffer}},{key:"smhd",value:function(){var t=new o.default;return t.write(e.size(16),e.type("smhd"),new Uint8Array([0,0,0,0,0,0,0,0])),t.buffer}},{key:"dinf",value:function(){var t=new o.default;return t.write(e.size(36),e.type("dinf"),e.size(28),e.type("dref"),new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1])),t.buffer}},{key:"stbl",value:function(t){var n=new o.default,i=8,r=e.stsd(t),a=e.stts(),u=e.stsc(),s=e.stsz(),f=e.stco();if("video"===t.type){var d=e.stss(t.stss);[r,a,d,u,s,f].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("stbl"),r,a,d,u,s,f)}else[r,a,u,s,f].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("stbl"),r,a,u,s,f);return n.buffer}},{key:"stsd",value:function(t){var n=new o.default,i=void 0;return i="audio"===t.type?e.mp4a(t):t.videoCodec.indexOf("hvc1")>-1?e.hvc1(t):e.avc1(t),n.write(e.size(16+i.byteLength),e.type("stsd"),e.extension(0,0),new Uint8Array([0,0,0,1]),i),n.buffer}},{key:"mp4a",value:function(t){var n=new o.default,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,t.sampleRate>>8&255,255&t.sampleRate,0,0]),r=e.esds(t.audioConfig);return n.write(e.size(8+i.byteLength+r.byteLength),e.type("mp4a"),i,r),n.buffer}},{key:"esds",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[43,146,8,0],n=t.length,i=new o.default,r=new Uint8Array([0,0,0,0,3,23+n,0,1,0,4,15+n,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([n]).concat(t).concat([6,1,2]));return i.write(e.size(8+r.byteLength),e.type("esds"),r),i.buffer}},{key:"avc1",value:function(t){var n=new o.default,i=t.sps,r=t.pps,a=t.width,u=t.height,s=t.pixelRatio[0],f=t.pixelRatio[1],d=new Uint8Array([1,i[1],i[2],i[3],255,225].concat([i.length>>>8&255,255&i.length]).concat(i).concat(1).concat([r.length>>>8&255,255&r.length]).concat(r)),l=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,a>>8&255,255&a,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c=new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192]),h=new Uint8Array([s>>24,s>>16&255,s>>8&255,255&s,f>>24,f>>16&255,f>>8&255,255&f]);return n.write(e.size(40+l.byteLength+d.byteLength+c.byteLength),e.type("avc1"),l,e.size(8+d.byteLength),e.type("avcC"),d,e.size(20),e.type("btrt"),c,e.size(16),e.type("pasp"),h),n.buffer}},{key:"hvc1",value:function(t){var n=new o.default,i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,t.width>>8&255,255&t.width,t.height>>8&255,255&t.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return n.write(e.size(8+i.byteLength+8+t.hvcCData.byteLength+10),e.type("hvc1"),i,e.size(8+t.hvcCData.byteLength),e.type("hvcC"),new Uint8Array(t.hvcCData),e.size(10),e.type("fiel"),new Uint8Array([1,0])),n.buffer}},{key:"stts",value:function(){var t=new o.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stts"),n),t.buffer}},{key:"stss",value:function(t){var n=new o.default,i=[];t.entries.forEach((function(e){i.push(e>>24),i.push(e>>16&255),i.push(e>>8&255),i.push(255&e)}));var r=new Uint8Array([0,0,0,0,t.count>>24,t.count>>16&255,t.count>>8&255,255&t.count].concat(i));return n.write(e.size(16+4*t.count),e.type("stss"),r),n.buffer}},{key:"stsc",value:function(){var t=new o.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stsc"),n),t.buffer}},{key:"stco",value:function(){var t=new o.default,n=new Uint8Array([0,0,0,0,0,0,0,0]);return t.write(e.size(16),e.type("stco"),n),t.buffer}},{key:"stsz",value:function(){var t=new o.default,n=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);return t.write(e.size(20),e.type("stsz"),n),t.buffer}},{key:"mvex",value:function(t,n){var i=new o.default,r=o.default.writeUint32(t*n);return i.write(e.size(88),e.type("mvex"),e.size(16),e.type("mehd"),e.extension(0,0),r,e.trex1(1),e.trex2(2)),i.buffer}},{key:"trex",value:function(t){var n=new o.default,i=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return n.write(e.size(8+i.byteLength),e.type("trex"),i),n.buffer}},{key:"trex1",value:function(t){var n=new o.default,i=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,2,0,0,0,0,0,0,1,0,0]);return n.write(e.size(8+i.byteLength),e.type("trex"),i),n.buffer}},{key:"trex2",value:function(t){var n=new o.default,i=new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t,0,0,0,1,0,0,4,0,0,0,0,0,2,0,0,0]);return n.write(e.size(8+i.byteLength),e.type("trex"),i),n.buffer}},{key:"moof",value:function(t){var n=new o.default,i=8,r=e.mfhd(t),a=e.traf(t);return[r,a].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("moof"),r,a),n.buffer}},{key:"mfhd",value:function(t){var n=new o.default,i=null;return i=(t.id,o.default.writeUint32((t.fragIndex||0)+1)),n.write(e.size(16),e.type("mfhd"),e.extension(0,0),i),n.buffer}},{key:"traf",value:function(t){var n=new o.default,i=8,r=e.tfhd(t.id),a=e.tfdt(t,t.time),u=e.sdtp(t),s=e.trun(t,u.byteLength);return[r,a,u,s].forEach((function(e){i+=e.byteLength})),n.write(e.size(i),e.type("traf"),r,a,u,s),n.buffer}},{key:"tfhd",value:function(t){var n=new o.default,i=o.default.writeUint32(t);return n.write(e.size(16),e.type("tfhd"),new Uint8Array([0,2,0,0]),i),n.buffer}},{key:"tfdt",value:function(t,n){var i=new o.default,r=Math.floor(n/(u+1)),a=Math.floor(n%(u+1));return i.write(e.size(20),e.type("tfdt"),e.extension(1,0),o.default.writeUint32(r),o.default.writeUint32(a)),i.buffer}},{key:"trun",value:function(t,n){var i=t.id,r=1===i?16:12,a=new o.default,u=o.default.writeUint32(t.samples.length),s=o.default.writeUint32(96+r*t.samples.length+n);return a.write(e.size(20+r*t.samples.length),e.type("trun"),e.extension(0,t.flags),u,s),t.samples.forEach((function(e,t){a.write(o.default.writeUint32(e.duration)),a.write(o.default.writeUint32(e.size)),1===i?(a.write(o.default.writeUint32(e.key?33554432:16842752)),a.write(o.default.writeUint32(e.offset))):a.write(o.default.writeUint32(16777216))})),a.buffer}},{key:"sdtp",value:function(t){var n=new o.default;return n.write(e.size(12+t.samples.length),e.type("sdtp"),e.extension(0,0)),t.samples.forEach((function(e){n.write(new Uint8Array(1===t.id?[e.key?32:16]:[16]))})),n.buffer}},{key:"mdat",value:function(t){var n=new o.default,i=8;return t.samples.forEach((function(e){i+=e.size})),n.write(e.size(i),e.type("mdat")),t.samples.forEach((function(e){n.write(e.buffer)})),n.buffer}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t={};if(e instanceof window.XMLHttpRequest)try{e.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach((function(e){var n=e.split(": "),i=n.shift(),r=n.join(": ");t[i]=r}))}catch(e){}return t},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i={findBox:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(e.type!==t){if(e&&e.subBox){var r=e.subBox.filter((function(e){return e.type===t}));r.length?r.forEach((function(e){return n.push(e)})):e.subBox.forEach((function(e){return i.findBox(e,t,n)}))}}else n.push(e);return(n=[].concat(n)).length>1?n:n[0]},padStart:function(e,t,n){for(var i=String(n),r=t>>0,a=Math.ceil(r/i.length),o=[],u=String(e);a--;)o.push(i);return o.join("").substring(0,r-u.length)+u},toHex:function(){for(var e=[],t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.push(i.padStart(Number(t).toString(16),2,0))})),e},sum:function(){for(var e=0,t=arguments.length,n=Array(t),i=0;i<t;i++)n[i]=arguments[i];return n.forEach((function(t){e+=t})),e},stscOffset:function(e,t,n){var i=n[t];if(i){var r=Math.floor((t-i.first_sample)/i.samples_per_chunk),a=i.first_sample+r*i.samples_per_chunk;return{chunk_index:i.first_chunk+r,samples_offset:[a,t]}}var o=e.entries.pop();e.entries.push(o);var u=Math.floor((t-o.first_sample)/o.samples_per_chunk);return{chunk_index:o.first_chunk+u,samples_offset:[o.first_sample+o.samples_per_chunk*u,t]}},seekSampleOffset:function(e,t,n,r,a,o){var u=i.stscOffset(e,r+1,o),s=i.sum.apply(null,n.entries.slice(u.samples_offset[0]-1,u.samples_offset[1]-1)),f=t.entries[u.chunk_index-1]+s-a;if(void 0===f)throw"result="+f+",stco.length="+t.entries.length+",sum="+i.sum.apply(null,n.entries.slice(0,r));if(f<0)throw"result="+f+",stco.length="+t.entries.length+",sum="+i.sum.apply(null,n.entries.slice(0,r));return f},seekSampleTime:function(e,t,n){var i=void 0,r=void 0,a=0,o=0,u=0;return e.entry.every((function(e){return r=e.sampleDuration,n<a+e.sampleCount?(i=o+(n-a)*e.sampleDuration,!1):(a+=e.sampleCount,o+=e.sampleCount*r,!0)})),t&&t[n]&&(u=t[n]),i||(i=o+(n-a)*r),{time:i,duration:r,offset:u}},seekOrderSampleByTime:function(e,t,n){var i=0,r=0,a=0,o=void 0;return e.every((function(e,u){return o=e.sampleCount*e.sampleDuration/t,n<=i+o?(r=a+Math.ceil((n-i)*t/e.sampleDuration),i+=Math.ceil((n-i)*t/e.sampleDuration)*e.sampleDuration/t,!1):(i+=o,a+=e.sampleCount,!0)})),{order:r,startTime:i}},seekTrakDuration:function(e,t){var n=i.findBox(e,"stts"),r=0;return n.entry.forEach((function(e){r+=e.sampleCount*e.sampleDuration})),Number(r/t).toFixed(4)},StringToArrayBuffer:function(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t},fromHex:function(e){for(var t=new Uint8Array(e.length/2),n=0;n<e.length;n+=2)t[n/2]=window.parseInt(e.substr(n,2),16);return t},fromCharCode:function(e){for(var t="",n=0;n<e.length;n+=16e3){var i=e.subarray(n,n+16e3);t+=String.fromCharCode.apply(null,i)}return t},ArrayBufferToString:function(e){for(var t="",n=new Uint8Array(e),i=0;i<n.length;i++)t+=String.fromCharCode(n[i]);return t},Base64ToHex:function(e){for(var t=window.atob(e.replace(/-/g,"+").replace(/_/g,"/")),n="",i=0;i<t.length;i++)n+=("0"+t.charCodeAt(i).toString(16)).substr(-2);return n},toBase64:function(e,t){var n=i.fromCharCode(e);t=void 0===t||t;var r=window.btoa(n).replace(/\+/g,"-").replace(/\//g,"_");return t?r:r.replace(/=*$/,"")},toUTF8:function(e){for(var t=encodeURIComponent(e),n=unescape(t),i=new Uint8Array(n.length),r=0;r<n.length;++r)i[r]=n.charCodeAt(r);return i.buffer},bufferToString:function(e){return("0"+Number(e).toString(16)).slice(-2).toUpperCase()},strToBuf:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e[n]+e[n+1],16));return new Uint8Array(t)},str2hex:function(e){if(""===e)return"";for(var t=[],n=0;n<e.length;n++)t.push(e.charCodeAt(n));return t},parse:function(e){if(!Array.isArray(e)){for(var t=[],n="",i=0;i<e.length;i++)i%2&&(n=e[i-1]+e[i],t.push(parseInt(n,16)),n="");return t}return e.map((function(e){return parseInt(e,16)}))}};t.default=i,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=o(n(4)),a=o(n(2));function o(e){return e&&e.__esModule?e:{default:e}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:'video/mp4; codecs="avc1.64001E, mp4a.40.5"',n=arguments[1];u(this,e),(0,r.default)(this),this.codecs=t,this.mediaSource=new window.MediaSource(n),this.url=window.URL.createObjectURL(this.mediaSource),this.queue=[],this.updating=!1,this._hasDestroyed=!1,this._hasEndOfStream=!1,this._hasEndOfStreamSuccess=!1,this._onSourceOpen=this._onSourceOpen.bind(this),this._onMediaSourceClose=this._onMediaSourceClose.bind(this),this._onSourceBufferError=this._onSourceBufferError.bind(this),this._onSourceBufferUpdateEnd=this._onSourceBufferUpdateEnd.bind(this),this.mediaSource.addEventListener("sourceopen",this._onSourceOpen),this.mediaSource.addEventListener("sourceclose",this._onMediaSourceClose)}return i(e,[{key:"_onSourceOpen",value:function(){this.sourceBuffer=this.mediaSource.addSourceBuffer(this.codecs),this.sourceBuffer.addEventListener("error",this._onSourceBufferError),this.sourceBuffer.addEventListener("updateend",this._onSourceBufferUpdateEnd),this.emit("sourceopen")}},{key:"_onSourceBufferError",value:function(e){this.emit("error",new a.default("mse","",{line:16,handle:"[MSE] constructor sourceopen",msg:e.message}))}},{key:"_onSourceBufferUpdateEnd",value:function(){if(this.emit("updateend"),!this._hasEndOfStream||this._hasEndOfStreamSuccess){var e=this.queue.shift();e&&this.sourceBuffer&&!1===this.sourceBuffer.updating&&"open"===this.state?this.sourceBuffer.appendBuffer(e):e&&this.queue.unshift(e)}else this._endOfStream()}},{key:"_onMediaSourceClose",value:function(){this.emit("sourceclose")}},{key:"appendBuffer",value:function(e){if(e){var t=this.sourceBuffer;return t&&!t.updating&&"open"===this.state?(t.appendBuffer(e),!0):(this.queue.push(e),!1)}}},{key:"removeBuffer",value:function(e,t){var n=this.sourceBuffer;n&&!1===n.updating&&"open"===this.state&&n.remove(e,t)}},{key:"endOfStream",value:function(){this._hasEndOfStream=!0,"open"===this.mediaSource.readyState&&this.sourceBuffer&&!this.sourceBuffer.updating&&(this._hasEndOfStreamSuccess=!0,this._endOfStream())}},{key:"_endOfStream",value:function(){this.queue=[],"open"===this.mediaSource.readyState&&this.mediaSource.endOfStream()}},{key:"destroy",value:function(){this._hasDestroyed||(this._hasDestroyed=!0,window.URL.revokeObjectURL(this.url),this.mediaSource&&(this.mediaSource.removeEventListener("sourceclose",this._onMediaSourceClose),this.mediaSource.removeEventListener("sourceopen",this._onSourceOpen)),this.sourceBuffer&&(this.sourceBuffer.removeEventListener("error",this._onSourceBufferError),this.sourceBuffer.removeEventListener("updateend",this._onSourceBufferUpdateEnd)))}},{key:"state",get:function(){return this.mediaSource.readyState}},{key:"duration",get:function(){return this.mediaSource.duration},set:function(e){this.mediaSource.duration=e}}],[{key:"isSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}}]),e}();t.default=s,e.exports=t.default},function(e,t,n){"use strict";t.isMSBrowser=function(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),n=e.indexOf("Trident/");return t>0||n>0},t.isMediaSourceSupported=function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource;return e&&"function"==typeof e.isTypeSupported},t.isSupported=function(){return t.isMediaSourceSupported()&&!t.isMSBrowser()},t.isSupportedWithXgmse=function(){return!t.isMSBrowser()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e);var t=void 0,n=void 0,i=new Promise((function(e,i){t=e,n=i}));return i.resolve=t,i.reject=n,i}return i(e,[{key:"resolve",value:function(e){}},{key:"reject",value:function(e){}}]),e}();t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.onTick_=t,this.cancelPending_=null}return i(e,[{key:"tickAfter",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.stop();var i=!0,r=null;this.cancelPending_=function(){window.clearTimeout(r),i=!1};var a=function(){i&&(t.onTick_(),n&&n())};return r=window.setTimeout(a,1e3*e),this}},{key:"tickEvery",value:function(e){var t=this;this.tickAfter(e,(function(){t.tickEvery(e)}))}},{key:"stop",value:function(){this.cancelPending_&&(this.cancelPending_(),this.cancelPending_=null)}}]),e}();t.default=r,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(91),o=(i=a)&&i.__esModule?i:{default:i};var u=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.player=t,this.mediaElem=t.video,this.config=n,this.timer=new o.default,this.prevReadyState=this.mediaElem.readyState,this.didFireLargeGap=!1,this.seekingEventReceived=!1,this.segmentAppended=!1,this.onWaitFunc=this._onWaiting.bind(this),this.onPlayFunc=this._onPlay.bind(this),this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),!1!==this.config.useGapJump&&this._start(),this.hasPlayed=!1}return r(e,[{key:"_onWaiting",value:function(){this.onGapJump("_onWaiting")}},{key:"_onPlay",value:function(){this.hasPlayed=!0}},{key:"_start",value:function(){var e=this;this.mediaElem.addEventListener("waiting",this.onWaitFunc),this.mediaElem.addEventListener("play",this.onPlayFunc),this.timer.repeat((function(){e.onGapJump("repeat")}),250)}},{key:"onSegmentAppend",value:function(){this.segmentAppended=!0,this.onGapJump("onSegmentAppend")}},{key:"onSeeking",value:function(){this.seekingEventReceived=!0,this.segmentAppended=!1,this.didFireLargeGap=!1}},{key:"onGapJump",value:function(t){if(this.mediaElem.readyState!==HTMLMediaElement.HAVE_NOTHING){if(this.mediaElem.seeking){if(!this.seekingEventReceived)return}else this.seekingEventReceived=!1;if(!this.mediaElem.paused||0===this.mediaElem.currentTime||!this.hasPlayed){this.mediaElem.readyState!==this.prevReadyState&&(this.didFireLargeGap=!1,this.prevReadyState=this.mediaElem.readyState);var n=this.mediaElem.buffered,i=this.config.smallGapLimit||.5,r=this.config.gapDetectionThreshold||.1,a=this.mediaElem.currentTime,o=this._getIndex(n,a,r);if(null!==o&&(0!==o||this.segmentAppended)){var u=n.start(o)+.1;if(!(u>this.mediaElem.duration)){var s=u-a,f=s<=i;s<e.BROWSER_GAP_TOLERANCE||f&&(!0!==this.config.disableGapSetPosition&&(this.mediaElem.currentTime=this.isSafari?u+.1:u),this.player&&this.player.emit("detectGap"))}}}}}},{key:"_getIndex",value:function(e,t,n){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(var i=this._getBuffered(e),r=null,a=0;a<i.length;a++){if(i[a].start>t&&(0===a||i[a-1].end-t<=n)){r=a;break}}return r}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}},{key:"destroy",value:function(){this.mediaElem.removeEventListener("waiting",this.onWaitFunc),this.mediaElem.removeEventListener("play",this.onPlayFunc),this.timer.clear(),this.timer=null}}]),e}();t.default=u,u.BROWSER_GAP_TOLERANCE=.001,e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.timeID=null,this.func=null}return i(e,[{key:"repeat",value:function(e,t){this.timeID=1,this.repeatInterval(e,t)}},{key:"repeatInterval",value:function(e,t){var n=this;this.timeID&&(null===this.func&&(this.func=e),this.func===e&&(this.timeID&&clearTimeout(this.timeID),this.timeID=null,this.timeID=setTimeout((function(){e(),n.repeatInterval(e,t)}),t)))}},{key:"clear",value:function(){clearTimeout(this.timeID),this.timeID=null}}]),e}();t.default=r,e.exports=t.default}])}));
//# sourceMappingURL=index.js.map